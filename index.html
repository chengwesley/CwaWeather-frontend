<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SYSTEM_WEATHER // V.2.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        :root {
            --hacker-green: #0f0;
            --hacker-dark-green: #003300;
            --hacker-bg: #000;
            --glitch-color: #0ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: var(--hacker-bg);
            color: var(--hacker-green);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* === Matrix Rain Background === */
        #matrixCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.3;
        }

        /* === CRT Scanline Effect === */
        body::before {
            content: " ";
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* === UI Layout === */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid var(--hacker-green);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .location-pill {
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 5px var(--hacker-green);
        }

        .update-pill {
            font-size: 0.8rem;
            background: var(--hacker-dark-green);
            color: var(--hacker-green);
            padding: 4px 10px;
            border: 1px solid var(--hacker-green);
        }

        .container {
            padding: 20px;
            max-width: 650px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        /* === Main Terminal Card === */
        .hero-card {
            background: rgba(0, 10, 0, 0.85);
            border: 1px solid var(--hacker-green);
            padding: 20px;
            margin-bottom: 25px;
            position: relative;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
        }

        .hero-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 10px;
            height: 10px;
            border-top: 2px solid var(--hacker-green);
            border-left: 2px solid var(--hacker-green);
        }

        .hero-card::before {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 10px;
            height: 10px;
            border-bottom: 2px solid var(--hacker-green);
            border-right: 2px solid var(--hacker-green);
        }

        .hero-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px dashed var(--hacker-dark-green);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .hero-period {
            background: var(--hacker-green);
            color: black;
            padding: 2px 8px;
            font-weight: bold;
        }

        .hero-temp-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }

        .hero-icon {
            font-size: 1.5rem;
            white-space: pre;
            line-height: 1.2;
            font-family: 'Courier New', Courier, monospace;
            text-shadow: 0 0 5px var(--hacker-green);
            overflow: hidden;
        }

        .hero-temp {
            font-size: 5rem;
            line-height: 1;
            text-shadow: 2px 2px 0px var(--hacker-dark-green);
        }

        .hero-desc {
            font-size: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 20px;
            animation: blink 2s infinite;
        }

        /* === Tactical Advice Grid === */
        .advice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            border-top: 1px solid var(--hacker-dark-green);
            padding-top: 15px;
        }

        .advice-item {
            background: rgba(0, 20, 0, 0.6);
            padding: 10px;
            border: 1px solid var(--hacker-dark-green);
        }

        .advice-label {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .advice-text {
            font-size: 1rem;
            font-weight: bold;
        }

        /* === Forecast Section === */
        .section-title {
            font-size: 1rem;
            color: var(--hacker-green);
            margin-bottom: 15px;
            border-left: 5px solid var(--hacker-green);
            padding-left: 10px;
            text-transform: uppercase;
        }

        .scroll-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--hacker-green) black;
        }
        
        .scroll-container::-webkit-scrollbar {
            height: 5px;
        }
        
        .scroll-container::-webkit-scrollbar-thumb {
            background: var(--hacker-green);
        }

        .mini-card {
            min-width: 160px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--hacker-dark-green);
            padding: 15px;
            flex-shrink: 0;
            position: relative;
        }

        .mini-card:hover {
            border-color: var(--hacker-green);
            box-shadow: 0 0 10px var(--hacker-green);
        }

        .mini-time {
            font-size: 0.8rem;
            border-bottom: 1px solid var(--hacker-dark-green);
            padding-bottom: 5px;
            margin-bottom: 10px;
            color: #fff;
        }

        .mini-temp {
            font-size: 1.2rem;
            margin: 10px 0;
        }

        /* === Loading Screen === */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: black;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
            font-family: 'Courier New', Courier, monospace;
        }

        .loader-text {
            margin-top: 20px;
            font-size: 1.2rem;
        }

        .progress-bar {
            width: 200px;
            height: 20px;
            border: 2px solid var(--hacker-green);
            margin-top: 20px;
            padding: 2px;
        }

        .progress-fill {
            height: 100%;
            background: var(--hacker-green);
            width: 0%;
            animation: load 1.5s linear forwards;
        }

        @keyframes load {
            0% { width: 0%; }
            50% { width: 40%; }
            70% { width: 45%; }
            100% { width: 100%; }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .glitch-text {
            position: relative;
        }

    </style>
</head>

<body>
    <canvas id="matrixCanvas"></canvas>

    <div id="loading" class="loading-screen">
        <div style="font-size: 4rem;">&lt;/&gt;</div>
        <div class="loader-text">INITIALIZING PROTOCOL...</div>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <div style="font-size: 0.8rem; margin-top: 10px; opacity: 0.7;">ENCRYPTING CONNECTION</div>
    </div>

    <div class="status-bar">
        <div class="location-pill">üìç TARGET: TP_CITY</div>
        <div id="updateTime" class="update-pill">SYNCING...</div>
    </div>

    <div class="container" id="mainContent" style="display: none;">

        <div id="heroCard">
            <!-- JS Injected Here -->
        </div>

        <h3 class="section-title">FUTURE_DATA_STREAM</h3>
        <div class="scroll-container" id="futureForecasts">
            <!-- JS Injected Here -->
        </div>

    </div>

    <script>
        // === Matrix Rain Effect ===
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const katakana = '„Ç¢„Ç°„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É£„É©„ÉØ„Ç¨„Ç∂„ÉÄ„Éê„Éë„Ç§„Ç£„Ç≠„Ç∑„ÉÅ„Éã„Éí„Éü„É™„É∞„ÇÆ„Ç∏„ÉÇ„Éì„Éî„Ç¶„Ç•„ÇØ„Çπ„ÉÑ„Éå„Éï„É†„É¶„É•„É´„Ç∞„Ç∫„Éñ„ÉÖ„Éó„Ç®„Çß„Ç±„Çª„ÉÜ„Éç„Éò„É°„É¨„É±„Ç≤„Çº„Éá„Éô„Éö„Ç™„Ç©„Ç≥„ÇΩ„Éà„Éé„Éõ„É¢„É®„Éß„É≠„É≤„Ç¥„Çæ„Éâ„Éú„Éù„É¥„ÉÉ„É≥0123456789Z';
        const characters = katakana.split('');
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = [];

        for(let x = 0; x < columns; x++) drops[x] = 1;

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0F0';
            ctx.font = fontSize + 'px monospace';

            for(let i = 0; i < drops.length; i++) {
                const text = characters[Math.floor(Math.random()*characters.length)];
                ctx.fillText(text, i*fontSize, drops[i]*fontSize);
                if(drops[i]*fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 33);
        
        window.addEventListener('resize', () => {
             canvas.width = window.innerWidth;
             canvas.height = window.innerHeight;
             // Reset columns on resize
             const newColumns = canvas.width / fontSize;
             // Preserve existing drops if possible, or reset
             if (newColumns > drops.length) {
                 for(let x = drops.length; x < newColumns; x++) drops[x] = 1;
             }
        });


        // === Weather Logic ===
        const API_URL = "https://taipei.zeabur.app/api/weather/kaohsiung";

        // Convert simple weather to ASCII/Tech Icon
        function getWeatherAscii(weather) {
            if (!weather) return "[ N/A ]";
            if (weather.includes("Êô¥")) return `
      \\ | /
    -- ( ) --
      / | \\
     [CLEAR]`;
            if (weather.includes("Â§öÈõ≤")) return `
      .--.
   .-(    ).
  (___.__)__)
   [CLOUDY]`;
            if (weather.includes("Èô∞")) return `
   _______
  (_______)
   [OVERCAST]`;
            if (weather.includes("Èõ®")) return `
   _______
  (_______)
   / / / /
   [RAIN]`;
            if (weather.includes("Èõ∑")) return `
   _______
  (_______)
    /  /
   /_ /
   [STORM]`;
            return "[ UNKNOWN ]";
        }

        // Hacked advice text
        function getTacticalAdvice(rainProb, maxTemp) {
            let rainStatus = "NEGLIGIBLE";
            let rainAction = "NO ACTION REQUIRED";
            
            if (parseInt(rainProb) > 30) {
                rainStatus = "CRITICAL";
                rainAction = "DEPLOY: UMBRELLA_SHIELD";
            }

            let tempStatus = "NOMINAL";
            let gearAction = "STANDARD_ATTIRE";

            if (parseInt(maxTemp) >= 28) {
                tempStatus = "OVERHEAT WARNING";
                gearAction = "EQUIP: LIGHT_ARMOR (SHORT)";
            } else if (parseInt(maxTemp) <= 20) {
                tempStatus = "LOW TEMP DETECTED";
                gearAction = "EQUIP: THERMAL_LAYER (COAT)";
            }

            return { rainStatus, rainAction, tempStatus, gearAction };
        }

        function getSystemTime(startTime) {
            const hour = new Date(startTime).getHours();
            if (hour >= 5 && hour < 11) return "CYCLE: MORNING";
            if (hour >= 11 && hour < 14) return "CYCLE: NOON";
            if (hour >= 14 && hour < 18) return "CYCLE: AFTERNOON";
            if (hour >= 18 && hour < 23) return "CYCLE: NIGHT";
            return "CYCLE: MIDNIGHT";
        }

        function renderWeather(data) {
            const forecasts = data.forecasts;
            const current = forecasts[0];
            const others = forecasts.slice(1);

            const advice = getTacticalAdvice(current.rain, current.maxTemp);
            const period = getSystemTime(current.startTime);
            const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);

            document.getElementById('heroCard').innerHTML = `
                <div class="hero-card">
                    <div class="hero-header">
                        <span>STATUS: ONLINE</span>
                        <div class="hero-period">${period}</div>
                    </div>
                    
                    <div class="hero-temp-container">
                        <pre class="hero-icon">${getWeatherAscii(current.weather)}</pre>
                        <div class="hero-temp">${avgTemp}<span style="font-size:1.5rem">¬∞C</span></div>
                    </div>
                    
                    <div class="hero-desc">>> ${current.weather}</div>
                    
                    <div class="advice-grid">
                        <div class="advice-item">
                            <div class="advice-label">PRECIPITATION_INDEX [${current.rain}%]</div>
                            <div class="advice-text" style="color:${advice.rainStatus === 'CRITICAL' ? 'red' : '#0f0'}">${advice.rainAction}</div>
                        </div>
                        <div class="advice-item">
                            <div class="advice-label">THERMAL_REGULATION [MAX: ${current.maxTemp}]</div>
                            <div class="advice-text">${advice.gearAction}</div>
                        </div>
                    </div>
                </div>
            `;

            const scrollContainer = document.getElementById('futureForecasts');
            scrollContainer.innerHTML = '';

            const todayDate = new Date().getDate();

            others.forEach(f => {
                let p = getSystemTime(f.startTime).replace("CYCLE: ", "");
                const fDate = new Date(f.startTime);
                if (fDate.getDate() !== todayDate) {
                    p = "T+1 // " + p;
                }

                scrollContainer.innerHTML += `
                    <div class="mini-card">
                        <div class="mini-time">${p}</div>
                        <div style="font-size:0.8rem; margin-bottom:5px;">${f.weather}</div>
                        <div class="mini-temp">${f.minTemp}¬∞ - ${f.maxTemp}¬∞</div>
                        <div style="font-size:0.7rem; color:#0f0; border:1px solid #003300; display:inline-block; padding:2px;">
                            H2O: ${f.rain}%
                        </div>
                    </div>
                `;
            });

            const now = new Date();
            // ISO format like 2023-11-27
            document.getElementById('updateTime').textContent = `LAST_SYNC: ${now.toISOString().slice(0,10).replace(/-/g,'')} ${now.getHours()}${now.getMinutes()}`;
        }

        async function fetchWeather() {
            try {
                // Keep the delay for the "hacking" visualization
                const delayPromise = new Promise(resolve => setTimeout(resolve, 2000));
                const fetchPromise = fetch(API_URL).then(res => res.json());

                const [_, json] = await Promise.all([delayPromise, fetchPromise]);

                if (json.success) {
                    renderWeather(json.data);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                } else {
                    throw new Error("API Failure");
                }
            } catch (e) {
                console.error(e);
                document.querySelector('.loader-text').innerText = "FATAL ERROR: CONNECTION LOST";
                document.querySelector('.loader-text').style.color = "red";
                document.querySelector('.progress-bar').style.borderColor = "red";
                document.querySelector('.progress-fill').style.backgroundColor = "red";
            }
        }

        document.addEventListener("DOMContentLoaded", fetchWeather);
    </script>
</body>

</html>